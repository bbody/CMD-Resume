flanguage: node_js
node_js:
- '7'
dist: trusty
sudo: required
before_script:
- npm install
- npm install -g gulp-cli
- sudo chown root /opt/google/chrome/chrome-sandbox
- sudo chmod 4755 /opt/google/chrome/chrome-sandbox
- "export DISPLAY=:99.0"
- "sh -e /etc/init.d/xvfb start"
script:
- npm run test
cache:
  directories:
  - node_modules
env:
  - CXX=g++-4.8 CC=gcc-4.8 CHROME_BIN=/usr/bin/google-chrome
addons:
  - apt:
    sources:
    - ubuntu-toolchain-r-test
    - google-chrome
    packages:
    - g++-4.8
    - google-chrome-stable
  - code_climate
  - firefox: latest
before_install:
- jdk_switcher use oraclejdk8
before_deploy:
- npm run release
- npm run gh-pages
- PACKAGE_VERSION=$(node -p -e "require('./package.json').version")
deploy:
  - provider: releases
    skip_cleanup: true
    api_key: $GITHUB_TOKEN
    name: ${PACKAGE_VERSION}
    file:
      - "./dist/cmd-resume.js"
      - "./dist/cmd-resume.min.js"
    on:
      branch: master
      tags: true
  - provider: pages
    skip_cleanup: true
    local_dir: ./tmp
    github_token: $GITHUB_TOKEN
    target_branch: gh-pages
    fqdn: cmd-resume.bbody.io
    repo: bbody/CMD-Resume
    on:
      branch: master
      tags: true
  - provider: npm
    skip_cleanup: true
    email: "bbody.project@gmail.com"
    api_key: $NPMJS_TOKEN
    on:
      branch: master
      tags: true
after_success:
  - npm install -g codeclimate-test-reporter
  - codeclimate-test-reporter < coverage/lcov.info
after_script:
  - "sh -e /etc/init.d/xvfb stop"
